<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Einstein Summation • einsum</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Einstein Summation">
<meta property="og:description" content="Einstein summation is a concise mathematical notation that 
  implicitly sums over repeated indices of n-dimensional arrays. Many ordinary
  matrix operations (e.g. transpose, matrix multiplication, scalar product, diag(), trace etc.)
  can be written using Einstein notation. The notation is particularly convenient for 
  expressing operations on arrays with more than two dimensions because the 
  respective operators (tensor products) might not have a standardized name.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">einsum</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="einsum" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#einsum" class="anchor"></a>einsum</h1></div>
<!-- badges: start -->

<p>Einstein summation is a concise mathematical notation that implicitly sums over repeated indices of n-dimensional arrays. Many ordinary matrix operations (e.g. transpose, matrix multiplication, scalar product, ‘diag()’, trace etc.) can be written using Einstein notation. The notation is particularly convenient for expressing operations on arrays with more than two dimensions because the respective operators (‘tensor products’) might not have a standardized name.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># install.packages("devtools")</span>
<span class="kw">devtools</span>::<span class="fu">install_github</span>(<span class="st">"const-ae/einsum"</span>)
</pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>Load the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">einsum</span>)
</pre></div>
<p>Let’s make two matrices:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">mat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n = <span class="fl">8</span> <span class="op">*</span> <span class="fl">4</span>), nrow = <span class="fl">8</span>, ncol = <span class="fl">4</span>)
<span class="kw">mat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n = <span class="fl">4</span> <span class="op">*</span> <span class="fl">4</span>), nrow = <span class="fl">4</span>, ncol = <span class="fl">4</span>)
</pre></div>
<p>We can use <code><a href="reference/einsum.html">einsum()</a></code> to calculate the matrix product:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="reference/einsum.html">einsum</a></span>(<span class="st">"ij, jk -&gt; ik"</span>, <span class="kw">mat1</span>, <span class="kw">mat2</span>)
<span class="co">#&gt;            [,1]       [,2]       [,3]        [,4]</span>
<span class="co">#&gt; [1,] -0.5087677  0.6680792  0.2909357  0.49456493</span>
<span class="co">#&gt; [2,] -1.1888008  0.9411126  0.6737345  0.39054429</span>
<span class="co">#&gt; [3,] -1.4715071  1.0242759  0.2400887 -0.31436543</span>
<span class="co">#&gt; [4,]  0.3899863 -1.1212621 -0.7660189 -2.28836686</span>
<span class="co">#&gt; [5,] -0.9058902  0.5529122  0.4775118  0.18014286</span>
<span class="co">#&gt; [6,] -1.4494020  1.6341965  1.4738795  2.73834635</span>
<span class="co">#&gt; [7,] -0.5380896  0.8600228  0.4430880 -0.06022769</span>
<span class="co">#&gt; [8,]  3.0707573 -2.5552313 -1.5538108 -1.28101253</span>
</pre></div>
<p>This is exactly the same as the standard matrix multiplication</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">mat1</span> <span class="op">%*%</span> <span class="kw">mat2</span>
<span class="co">#&gt;            [,1]       [,2]       [,3]        [,4]</span>
<span class="co">#&gt; [1,] -0.5087677  0.6680792  0.2909357  0.49456493</span>
<span class="co">#&gt; [2,] -1.1888008  0.9411126  0.6737345  0.39054429</span>
<span class="co">#&gt; [3,] -1.4715071  1.0242759  0.2400887 -0.31436543</span>
<span class="co">#&gt; [4,]  0.3899863 -1.1212621 -0.7660189 -2.28836686</span>
<span class="co">#&gt; [5,] -0.9058902  0.5529122  0.4775118  0.18014286</span>
<span class="co">#&gt; [6,] -1.4494020  1.6341965  1.4738795  2.73834635</span>
<span class="co">#&gt; [7,] -0.5380896  0.8600228  0.4430880 -0.06022769</span>
<span class="co">#&gt; [8,]  3.0707573 -2.5552313 -1.5538108 -1.28101253</span>
</pre></div>
<p>This was a fairly simple example and there seems little benefit of using it over the more familiar matrix product expression. ‘einsum’ even is a lot slower.</p>
<p>However, ‘einsum’ truly shines when working with more than 2-dimensional arrays, where it can be difficult to figure out the correct kind of tensor product:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Make some n-dimensional arrays</span>
<span class="kw">arr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">3</span> <span class="op">*</span> <span class="fl">9</span> <span class="op">*</span> <span class="fl">2</span>), dim = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">2</span>))
<span class="kw">arr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">2</span> <span class="op">*</span> <span class="fl">5</span>), dim = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">5</span>))
<span class="kw">arr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">9</span> <span class="op">*</span> <span class="fl">3</span>), dim = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">9</span>, <span class="fl">3</span>))

<span class="fu"><a href="reference/einsum.html">einsum</a></span>(<span class="st">"abc, cd, ba -&gt; d"</span>, <span class="kw">arr1</span>, <span class="kw">arr2</span>, <span class="kw">arr3</span>)
<span class="co">#&gt; [1] -0.7015596 -4.0114655 -1.6420695 -3.4131292  0.7233701</span>
</pre></div>
<p>The equivalent expression using tensor products (which are not intuitive) would look like this (and believe me it took me more than one try to figure out this formula):</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">tensor</span>::<span class="fu">tensor</span>(<span class="kw">tensor</span>::<span class="fu">tensor</span>(<span class="kw">arr1</span>, <span class="kw">arr2</span>, alongA = <span class="fl">3</span>, alongB = <span class="fl">1</span>), <span class="kw">arr3</span>, alongA = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>), alongB = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))
<span class="co">#&gt; [1] -0.7015596 -4.0114655 -1.6420695 -3.4131292  0.7233701</span>
</pre></div>
<p>If you need to do the same computation over and over again, you can use <code><a href="reference/einsum.html">einsum_generator()</a></code> which generates and compiles efficient C++ to do exactly that calculation. It can take a few seconds, to create the function with <code><a href="reference/einsum.html">einsum_generator()</a></code>, however the returned function can be one or two orders of magnitude faster than <code><a href="reference/einsum.html">einsum()</a></code></p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># einsum_generator returns a function</span>
<span class="kw">array_prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/einsum.html">einsum_generator</a></span>(<span class="st">"abc, cd, ba -&gt; d"</span>)
<span class="fu">array_prod</span>(<span class="kw">arr1</span>, <span class="kw">arr2</span>, <span class="kw">arr3</span>)
<span class="co">#&gt; [1] -0.7015596 -4.0114655 -1.6420695 -3.4131292  0.7233701</span>
</pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">bench</span>::<span class="fu">mark</span>(
  tensor = <span class="kw">tensor</span>::<span class="fu">tensor</span>(<span class="kw">tensor</span>::<span class="fu">tensor</span>(<span class="kw">arr1</span>, <span class="kw">arr2</span>, alongA = <span class="fl">3</span>, alongB = <span class="fl">1</span>), 
                          <span class="kw">arr3</span>, alongA = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>), alongB = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>)),
  einsum = <span class="fu"><a href="reference/einsum.html">einsum</a></span>(<span class="st">"abc, cd, ba -&gt; d"</span>, <span class="kw">arr1</span>, <span class="kw">arr2</span>, <span class="kw">arr3</span>),
  einsum_generator = <span class="fu">array_prod</span>(<span class="kw">arr1</span>, <span class="kw">arr2</span>, <span class="kw">arr3</span>)
)
<span class="co">#&gt; # A tibble: 3 x 6</span>
<span class="co">#&gt;   expression            min   median `itr/sec` mem_alloc `gc/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt;       &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 tensor               58µs   66.1µs    14714.    2.93KB     95.7</span>
<span class="co">#&gt; 2 einsum              247µs  267.4µs     3572.    2.49KB     25.4</span>
<span class="co">#&gt; 3 einsum_generator      3µs    3.8µs   231928.    2.49KB      0</span>
</pre></div>
</div>
</div>
<div id="credit" class="section level1">
<h1 class="hasAnchor">
<a href="#credit" class="anchor"></a>Credit</h1>
<p>This package is inspired by the equivalent function in <a href="https://numpy.org/doc/stable/reference/generated/numpy.einsum.html">NumPy</a>.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Constantin Ahlmann-Eltze <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3762-068X" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/const-ae/einsum/actions"><img src="https://github.com/const-ae/einsum/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/const-ae/einsum?branch=master"><img src="https://codecov.io/gh/const-ae/einsum/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Constantin Ahlmann-Eltze.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
