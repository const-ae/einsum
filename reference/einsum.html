<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Einstein Summation — einsum • einsum</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Einstein Summation — einsum" />
<meta property="og:description" content="

Einstein summation is a convenient and concise notation for operations
on n-dimensional arrays." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">einsum</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Einstein Summation</h1>
    
    <div class="hidden name"><code>einsum.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

Einstein summation is a convenient and concise notation for operations
on n-dimensional arrays.</p>
    </div>

    <pre class="usage"><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='kw'>equation_string</span>, <span class='kw'>...</span>)

<span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum_generator</a></span>(<span class='kw'>equation_string</span>, compile_function = <span class='fl'>TRUE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>equation_string</th>
      <td><p>a string in Einstein notation where arrays
are separated by ',' and the result is separated by '-&gt;'. For
example <code>"ij,jk-&gt;ik"</code> corresponds to a standard matrix multiplication.
Whitespace inside the <code>equation_string</code> is ignored. Unlike the
equivalent functions in Python, <code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum()</a></code> only supports the explicit
mode. This means that the <code>equation_string</code> must contain '-&gt;'.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>the arrays that are combined. All arguments are converted
to arrays with <code>as.array</code>.</p></td>
    </tr>
    <tr>
      <th>compile_function</th>
      <td><p>boolean that decides if <code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum_generator()</a></code>
returns the result of <code><a href='https://rdrr.io/pkg/Rcpp/man/cppFunction.html'>Rcpp::cppFunction()</a></code> or the program as a
string. Default: <code>TRUE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The following table show, how the Einstein notation abbreviates complex
summation for arrays/matrices:</p>
<table class='table'>
<tr><td><code>equation_string</code></td><td>Formula</td><td></td></tr>
<tr><td>------------------------</td><td>--------------------------------------</td><td>----------------------------------</td></tr>
<tr><td><code>"ij,jk-&gt;ik"</code></td><td>\( Y_{ik} = \sum_{j}{A_{ij} B_{jk}}  \)</td><td>Matrix multiplication</td></tr>
<tr><td><code>"ij-&gt;ji"</code>`</td><td>\( Y = A^{T}  \)</td><td>Transpose</td></tr>
<tr><td><code>"ii-&gt;i"</code></td><td>\(y = \text{diag}(A)\)</td><td>Diagonal</td></tr>
<tr><td><code>"ii-&gt;ii"</code></td><td>\(Y = \text{diag}(A) I\)</td><td>Diagonal times Identity</td></tr>
<tr><td><code>"ii-&gt;"</code></td><td>\(y = \text{trace}(A) = \sum_i{A_{ii}} \)</td><td>Trace</td></tr>
<tr><td><code>"ijk,mjj-&gt;i"</code></td><td>\( y_i = \sum_{j}\sum_{k}\sum_{m}A_{ijk}B_{mjj}  \)</td><td>Complex 3D operation</td></tr>
</table>



<p>The function and the conventions are inspired by the <code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum()</a></code> function
in NumPy (<a href='https://numpy.org/doc/stable/reference/generated/numpy.einsum.html'>documentation</a>).
Unlike NumPy, 'einsum' only supports the explicit mode. The explicit mode is more flexible and
can avoid confusion. The common summary of the Einstein  summation to
"sum over duplicated indices" however is not a good mental model. A better rule of thumb is
"sum over all indices not in the result".</p>
<p><em>Note:</em> <code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum()</a></code> internally uses C++ code to speed up the calculations. However,
if you need to do the same calculation over and over again it can be worth to use
<code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum_generator()</a></code> and call the returned the function. <code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum_generator()</a></code>
generates efficient C++ code that can be one or two orders of magnitude faster than
<code><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum()</a></code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>mat1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(n = <span class='fl'>4</span> <span class='op'>*</span> <span class='fl'>8</span>), nrow = <span class='fl'>4</span>, ncol = <span class='fl'>8</span>)
<span class='kw'>mat2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(n = <span class='fl'>8</span> <span class='op'>*</span> <span class='fl'>3</span>), nrow = <span class='fl'>8</span>, ncol = <span class='fl'>3</span>)

<span class='co'># Matrix Multiply</span>
<span class='kw'>mat1</span> <span class='op'>%*%</span> <span class='kw'>mat2</span></div><div class='output co'>#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.2441351 -0.3344163 -2.348732
#&gt; [2,]  0.5290658 -0.1933795 -2.828903
#&gt; [3,] -3.0636701 -1.9637461  2.942458
#&gt; [4,]  1.6505211  2.3222916  1.766643</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ij,jk -&gt; ik"</span>, <span class='kw'>mat1</span>, <span class='kw'>mat2</span>)</div><div class='output co'>#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.2441351 -0.3344163 -2.348732
#&gt; [2,]  0.5290658 -0.1933795 -2.828903
#&gt; [3,] -3.0636701 -1.9637461  2.942458
#&gt; [4,]  1.6505211  2.3222916  1.766643</div><div class='input'>
<span class='co'># einsum_generator() works just like einsum() but returns a performant function</span>
<span class='kw'>mat_mult</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum_generator</a></span>(<span class='st'>"ij,jk -&gt; ik"</span>)
<span class='fu'>mat_mult</span>(<span class='kw'>mat1</span>, <span class='kw'>mat2</span>)</div><div class='output co'>#&gt;            [,1]       [,2]      [,3]
#&gt; [1,] -0.2441351 -0.3344163 -2.348732
#&gt; [2,]  0.5290658 -0.1933795 -2.828903
#&gt; [3,] -3.0636701 -1.9637461  2.942458
#&gt; [4,]  1.6505211  2.3222916  1.766643</div><div class='input'>
<span class='co'># Diag</span>
<span class='kw'>mat_sq</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(n = <span class='fl'>4</span> <span class='op'>*</span> <span class='fl'>4</span>), nrow = <span class='fl'>4</span>, ncol = <span class='fl'>4</span>)
<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='kw'>mat_sq</span>)</div><div class='output co'>#&gt; [1] -2.2741149 -0.6650882  1.0650573  0.2841503</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ii-&gt;i"</span>, <span class='kw'>mat_sq</span>)</div><div class='output co'>#&gt; [1] -2.2741149 -0.6650882  1.0650573  0.2841503</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ii-&gt;ii"</span>, <span class='kw'>mat_sq</span>)</div><div class='output co'>#&gt;           [,1]       [,2]     [,3]      [,4]
#&gt; [1,] -2.274115  0.0000000 0.000000 0.0000000
#&gt; [2,]  0.000000 -0.6650882 0.000000 0.0000000
#&gt; [3,]  0.000000  0.0000000 1.065057 0.0000000
#&gt; [4,]  0.000000  0.0000000 0.000000 0.2841503</div><div class='input'>
<span class='co'># Trace</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/diag.html'>diag</a></span>(<span class='kw'>mat_sq</span>))</div><div class='output co'>#&gt; [1] -1.589995</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ii-&gt;"</span>, <span class='kw'>mat_sq</span>)</div><div class='output co'>#&gt; [1] -1.589995</div><div class='input'>

<span class='co'># Scalar product</span>
<span class='kw'>mat3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(n = <span class='fl'>4</span> <span class='op'>*</span> <span class='fl'>8</span>), nrow = <span class='fl'>4</span>, ncol = <span class='fl'>8</span>)
<span class='kw'>mat3</span> <span class='op'>*</span> <span class='kw'>mat1</span></div><div class='output co'>#&gt;              [,1]        [,2]       [,3]       [,4]        [,5]        [,6]
#&gt; [1,] -1.872306774  0.37712590 -0.4699239 -1.1321649 -0.22649590  0.49095945
#&gt; [2,]  0.060432598 -0.12625140 -0.3670627 -1.8112706  0.02009136 -0.01382949
#&gt; [3,] -3.213028494 -0.31368369 -0.4146053 -1.3386305  0.23033230 -0.63420243
#&gt; [4,] -0.002918852  0.02234022  0.3498551  0.2900593 -0.97175477  1.23421318
#&gt;              [,7]       [,8]
#&gt; [1,] -0.669212804  0.3201439
#&gt; [2,] -0.092216969  1.1878881
#&gt; [3,] -1.232348460 -0.9884328
#&gt; [4,]  0.004731501 -0.1404040</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ij,ij-&gt;ij"</span>, <span class='kw'>mat3</span>, <span class='kw'>mat1</span>)</div><div class='output co'>#&gt;              [,1]        [,2]       [,3]       [,4]        [,5]        [,6]
#&gt; [1,] -1.872306774  0.37712590 -0.4699239 -1.1321649 -0.22649590  0.49095945
#&gt; [2,]  0.060432598 -0.12625140 -0.3670627 -1.8112706  0.02009136 -0.01382949
#&gt; [3,] -3.213028494 -0.31368369 -0.4146053 -1.3386305  0.23033230 -0.63420243
#&gt; [4,] -0.002918852  0.02234022  0.3498551  0.2900593 -0.97175477  1.23421318
#&gt;              [,7]       [,8]
#&gt; [1,] -0.669212804  0.3201439
#&gt; [2,] -0.092216969  1.1878881
#&gt; [3,] -1.232348460 -0.9884328
#&gt; [4,]  0.004731501 -0.1404040</div><div class='input'>
<span class='co'># Transpose</span>
<span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span>(<span class='kw'>mat1</span>)</div><div class='output co'>#&gt;            [,1]        [,2]       [,3]         [,4]
#&gt; [1,] -1.4000435  0.25531705 -2.4372636 -0.005571287
#&gt; [2,]  0.6215527  1.14841161 -1.8218177 -0.247325302
#&gt; [3,] -0.2441996 -0.28270545 -0.5536994  0.628982042
#&gt; [4,]  2.0650249 -1.63098940  0.5124269 -1.863011492
#&gt; [5,] -0.5220125 -0.05260191  0.5429963 -0.914074827
#&gt; [6,]  0.4681544  0.36295126 -1.3045435  0.737776321
#&gt; [7,]  1.8885049 -0.09744510 -0.9358474 -0.015950311
#&gt; [8,] -0.8267890 -1.51239965  0.9353632  0.176488611</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ij-&gt;ji"</span>, <span class='kw'>mat1</span>)</div><div class='output co'>#&gt;            [,1]        [,2]       [,3]         [,4]
#&gt; [1,] -1.4000435  0.25531705 -2.4372636 -0.005571287
#&gt; [2,]  0.6215527  1.14841161 -1.8218177 -0.247325302
#&gt; [3,] -0.2441996 -0.28270545 -0.5536994  0.628982042
#&gt; [4,]  2.0650249 -1.63098940  0.5124269 -1.863011492
#&gt; [5,] -0.5220125 -0.05260191  0.5429963 -0.914074827
#&gt; [6,]  0.4681544  0.36295126 -1.3045435  0.737776321
#&gt; [7,]  1.8885049 -0.09744510 -0.9358474 -0.015950311
#&gt; [8,] -0.8267890 -1.51239965  0.9353632  0.176488611</div><div class='input'>

<span class='co'># Batched L2 norm</span>
<span class='kw'>arr1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>mat1</span>, <span class='kw'>mat3</span>), dim = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='kw'>mat1</span>), <span class='fl'>2</span>))
<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='kw'>mat1</span><span class='op'>^</span><span class='fl'>2</span>), <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>(<span class='kw'>mat3</span><span class='op'>^</span><span class='fl'>2</span>))</div><div class='output co'>#&gt; [1] 36.88225 30.05625</div><div class='input'><span class='fu'><a href='https://rdrr.io/pkg/einsum/man/einsum.html'>einsum</a></span>(<span class='st'>"ijb,ijb-&gt;b"</span>, <span class='kw'>arr1</span>, <span class='kw'>arr1</span>)</div><div class='output co'>#&gt; [1] 36.88225 30.05625</div><div class='input'></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Constantin Ahlmann-Eltze.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


